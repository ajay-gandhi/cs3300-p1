<!DOCTYPE HTML>
<html>

<head>
  <title>
  	CS3300-P1 Visualization
  </title>
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
	<style>
		body { font-family: "Source Sans Pro"; 
			margin: 50px; 
			}
		.axis path,
		.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		.axis { 
			font-size: .7em;
		}
		text {
			font-size: 0.5rem;
		}
		.title {
			font-size: 1rem;
		}
	</style>
</head>
<body>
	<h2>Project 1 </h2>
	<p>Notes: variable crimeType is for x-axis measure, crimeType2 is for size of circle, feel free to change these up.
		<div class="vis">
		</div>
		<div class="vis2">
		</div>
		<div class="vis3">
		</div>
		<div id="map">
		</div>

	<script>
	//specify crime typs
	// var possibleCrimes = ["Index", "Aggravated Assault", "Burglary", "Forcible Rape", "Murder", "Property", "
	// Forcible Rape", "Robbery", "Larceny - Theft", "Vehicle Theft", "Violent"];
	var crimeType = "Burglary";
	var crimeType2 = "Population";

	d3.json("data.json", function(error, data){
		visualize(data, crimeType, 1200, 700);
		visualize(data, "Violent", 600, 700);
		visualize(data, "Burglary", 1200, 700);
	});

	function visualize(data, crimeType, svgWidth, svgHeight){
		//everything is nested in the callback function
		var crimeData = d3.entries(data);
		//combine datasets data.json and test.json
		d3.json("poverty.json", function(error, d){
			var povertyData = d.unemployment;
			var completeData = [], obj_poverty_processed = [];
			for (var i in crimeData) {
	    		var obj = {key: crimeData[i].key, value: crimeData[i].value};
		    	for (var j in povertyData) {
		        	if ( abbrState( crimeData[i].key ,"name") == povertyData[j].state) {

		            	obj.rate = povertyData[j].rate;
		            	if (povertyData[j].state == "Louisiana"){
		        			console.log(povertyData[j].rate);
		        		}
		            	obj_poverty_processed[povertyData[j].state] = true;
		        	}
		  		}
			    obj.rate = obj.rate || 'no';
			    completeData.push(obj);
			}
		console.log(completeData);
		
		//svg
		var width=svgWidth;
		var height=svgHeight;
		var padding =100;
		var svg = d3.select(".vis")
		.append("svg")
		.attr("width",width)
		.attr("height",height);

		//max/min of crimeType, used for scaling x-axis
		var max = d3.max(completeData, function(el){
			return (el.value[2013][crimeType] * 100000) / el.value[2013].Population
		});
		var min = d3.min(completeData, function(el){
			return (el.value[2013][crimeType] * 100000) / el.value[2013].Population
		});
		//maximum of crimeType2, used for scaling circles
		var max2 = d3.max(completeData, function(el){
			if (crimeType2=="Population"){
				return el.value[2013][crimeType2];
			}
			return (el.value[2013][crimeType2] * 100000) / el.value[2013].Population
		});
		console.log(max2);


		//scales
		var xScale = d3.scale.linear().domain([0, max]).range([padding, width - padding]);
		var yScale = d3.scale.linear().domain([5, 24]).range([height - padding, padding]);
		var circleScale = d3.scale.sqrt().domain([0, max2]).range([0,30]);
		var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("d"));
		var yAxis = d3.svg.axis().scale(yScale).orient("left");
		var colorScale = d3.scale.linear().domain([0,30]).range(["#ffffff","#ff12a5"]);
		//axis
		
		//title
		svg.append("text").text("2013 " + crimeType + " count per 100,000 of State population, compared to Poverty Rate (%)").attr("x",width/2).attr("y",30).attr("text-anchor","middle").attr("class","title");
		svg.append("text").text("Circle size currently showing: " + crimeType2).attr("x",width/2).attr("y",60).attr("text-anchor","middle");

		//axis
		svg.append("text").text(crimeType + " per 100,000 of population").attr("x",width/2).attr("y",height - padding/2).attr("text-anchor","middle");
		svg.append("text").text("Poverty Rate").attr("x",padding/2).attr("y",height/2).attr("text-anchor","middle");

		for (var i in completeData){
			console.log(i["key"]);
		}
		console.log(completeData[5]);
		console.log(completeData[3].value[2013][crimeType]);


		var dataPoints = 
		svg.selectAll("g")
		.data(completeData)
		.enter()
		.append("g")
		.attr("transform", function(d, i){
			// if (d["key"] == "hi") {
			// 	console.log("me!" );
			// }
			return "translate(" + xScale( (d.value[2013][crimeType] * 100000 )/ d.value[2013].Population ) + "," + 
				yScale(d.rate)		
				 + ")";
		});

		dataPoints.append("circle")
		.attr("r", function(d) {
			if (crimeType2=="Population"){
				return circleScale(d.value[2013][crimeType2]);
			}
			return circleScale( (d.value[2013][crimeType2] * 100000 )/ d.value[2013].Population ) })
		.attr("fill", "rgba(127, 127, 255, 0.3)");

		dataPoints.append("text")
		.text( function(d) {return abbrState(d.key, 'name') });

		//axis
		svg.append("g").attr("transform", "translate(0," + (height - padding) + ")").attr("class", "axis")
		.call(xAxis);
		svg.append("g").attr("transform", "translate(" + padding + ",0)").attr("class", "axis")
		.call(yAxis);


		});
	}

	//name to abbrieviation, or abbrieviation to name
	function abbrState(input, to){
	    
	    var states = [
	        ['Arizona', 'AZ'],
	        ['Alabama', 'AL'],
	        ['Alaska', 'AK'],
	        ['Arizona', 'AZ'],
	        ['Arkansas', 'AR'],
	        ['California', 'CA'],
	        ['Colorado', 'CO'],
	        ['Connecticut', 'CT'],
	        ['Delaware', 'DE'],
	        ['Florida', 'FL'],
	        ['Georgia', 'GA'],
	        ['Hawaii', 'HI'],
	        ['Idaho', 'ID'],
	        ['Illinois', 'IL'],
	        ['Indiana', 'IN'],
	        ['Iowa', 'IA'],
	        ['Kansas', 'KS'],
	        ['Kentucky', 'KY'],
	        ['Louisiana', 'LA'],
	        ['Maine', 'ME'],
	        ['Maryland', 'MD'],
	        ['Massachusetts', 'MA'],
	        ['Michigan', 'MI'],
	        ['Minnesota', 'MN'],
	        ['Mississippi', 'MS'],
	        ['Missouri', 'MO'],
	        ['Montana', 'MT'],
	        ['Nebraska', 'NE'],
	        ['Nevada', 'NV'],
	        ['New Hampshire', 'NH'],
	        ['New Jersey', 'NJ'],
	        ['New Mexico', 'NM'],
	        ['New York', 'NY'],
	        ['North Carolina', 'NC'],
	        ['North Dakota', 'ND'],
	        ['Ohio', 'OH'],
	        ['Oklahoma', 'OK'],
	        ['Oregon', 'OR'],
	        ['Pennsylvania', 'PA'],
	        ['Rhode Island', 'RI'],
	        ['South Carolina', 'SC'],
	        ['South Dakota', 'SD'],
	        ['Tennessee', 'TN'],
	        ['Texas', 'TX'],
	        ['Utah', 'UT'],
	        ['Vermont', 'VT'],
	        ['Virginia', 'VA'],
	        ['Washington', 'WA'],
	        ['West Virginia', 'WV'],
	        ['Wisconsin', 'WI'],
	        ['Wyoming', 'WY'],
	    ];

	    if (to == 'abbr'){
	        input = input.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
	        for(i = 0; i < states.length; i++){
	            if(states[i][0] == input){
	                return(states[i][1]);
	            }
	        }    
	    } else if (to == 'name'){
	        input = input.toUpperCase();
	        for(i = 0; i < states.length; i++){
	            if(states[i][1] == input){
	                return(states[i][0]);
	            }
	        }    
	    }
	}

	</script>


</body>

</html>