<!DOCTYPE HTML>
<html>

<head>
  <title>
  	CS3300-P1 Visualization
  </title>
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
	<style>
		body { font-family: "Source Sans Pro"; 
			margin: 50px; }
			 svg { border: solid black 1px; }
			.axis path,
			.axis line {
			    fill: none;
			    stroke: black;
			    shape-rendering: crispEdges;
			}
			.axis { font-size: .2em;
			}
			.rect-anchor-center {
				  /* 
				  Set position anchor to (center, center).
				  */
				transform: translate(-50%, -50%);
			}
	</style>
</head>
<body>
<h2>Project 1 - Kevin, Ajay, Shangyuan</h2>
	<div class="vis">
	</div>
	<div id="map">
	</div>
<script>

function abbrState(input, to){
    
    var states = [
        ['Arizona', 'AZ'],
        ['Alabama', 'AL'],
        ['Alaska', 'AK'],
        ['Arizona', 'AZ'],
        ['Arkansas', 'AR'],
        ['California', 'CA'],
        ['Colorado', 'CO'],
        ['Connecticut', 'CT'],
        ['Delaware', 'DE'],
        ['Florida', 'FL'],
        ['Georgia', 'GA'],
        ['Hawaii', 'HI'],
        ['Idaho', 'ID'],
        ['Illinois', 'IL'],
        ['Indiana', 'IN'],
        ['Iowa', 'IA'],
        ['Kansas', 'KS'],
        ['Kentucky', 'KY'],
        ['Kentucky', 'KY'],
        ['Louisiana', 'LA'],
        ['Maine', 'ME'],
        ['Maryland', 'MD'],
        ['Massachusetts', 'MA'],
        ['Michigan', 'MI'],
        ['Minnesota', 'MN'],
        ['Mississippi', 'MS'],
        ['Missouri', 'MO'],
        ['Montana', 'MT'],
        ['Nebraska', 'NE'],
        ['Nevada', 'NV'],
        ['New Hampshire', 'NH'],
        ['New Jersey', 'NJ'],
        ['New Mexico', 'NM'],
        ['New York', 'NY'],
        ['North Carolina', 'NC'],
        ['North Dakota', 'ND'],
        ['Ohio', 'OH'],
        ['Oklahoma', 'OK'],
        ['Oregon', 'OR'],
        ['Pennsylvania', 'PA'],
        ['Rhode Island', 'RI'],
        ['South Carolina', 'SC'],
        ['South Dakota', 'SD'],
        ['Tennessee', 'TN'],
        ['Texas', 'TX'],
        ['Utah', 'UT'],
        ['Vermont', 'VT'],
        ['Virginia', 'VA'],
        ['Washington', 'WA'],
        ['West Virginia', 'WV'],
        ['Wisconsin', 'WI'],
        ['Wyoming', 'WY'],
    ];

    if (to == 'abbr'){
        input = input.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        for(i = 0; i < states.length; i++){
            if(states[i][0] == input){
                return(states[i][1]);
            }
        }    
    } else if (to == 'name'){
        input = input.toUpperCase();
        for(i = 0; i < states.length; i++){
            if(states[i][1] == input){
                return(states[i][0]);
            }
        }    
    }
}
</script>

<script>
function visualizeData(data){
	var width=900;
	var height=600;
	var padding =50;
	var svg = d3.select(".vis")
	.append("svg")
	.attr("width",width)
	.attr("height",height);

	//specify parameters
	var crimeType="Theft";
	var state="fl";

	var stateData = d3.values(data[state]);

	//find max/min
	var allValues=[];
	for (var i=0;i<stateData.length;i++){
		allValues.push(+stateData[i][crimeType]);
	}
	var max = d3.max(allValues);
	var min = d3.min(allValues);
		 console.log(allValues);


	//title 
	svg.append("text").text(crimeType + " in the state of " + abbrState(state, "name")).attr("x",width/2).attr("y",30).attr("text-anchor","middle");

	//scales
	var xScale = d3.scale.linear().domain([1960, 2014]).range([padding, width - padding]);
	var yScale = d3.scale.linear().domain([0, max]).range([height - padding, padding]);
	var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("d"));
	var yAxis = d3.svg.axis().scale(yScale).orient("left");
	var colorScale = d3.scale.linear().domain([0,30]).range(["#ffffff","#ff12a5"]);

	//axis
	svg.append("g").attr("transform", "translate(0," + (height - padding) + ")").attr("class", "axis")
	.call(xAxis);
	svg.append("g").attr("transform", "translate(" + padding + ",0)").attr("class", "axis")
	.call(yAxis);

	
	//changes to an array of values (gets rid of year keys)
	var stateData = d3.values(data[state]);

	svg.selectAll("rect")
	.data(stateData)
	.enter()
	.append("rect")
	.attr("width", xScale(1961)-xScale(1960))
	.attr("x", function(d, i) {return xScale(i+1960-0.5)})
	.attr("height", function(d, i) {return height-padding-yScale(d[crimeType]) })
	.attr("y", function(d, i) {return yScale(d[crimeType])})
	.attr("fill", "#e6e6e6")
	
	 console.log(d3.values(data.fl));
}

d3.json("data.json", function(error, data){
	visualizeData(data);
});


</script>

<script>
var width = 960,
    height = 500;

var projection = d3.geo.albersUsa();

var path = d3.geo.path().projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);
var counties, states;


var usdaAtlas;

var digitScale = d3.scale.category10()
//piece wise linear function.
//check out colorbrewer2.org
//colorblindness is on x chromosome

var populationScale = d3.scale.linear().domain([-5, 0, 5]).range(["#d8b365", "#f5f5f5", "#5ab4ac"]);

d3.json("us.json", function(shapes) {
	//taking data from us.json, calling Topojson library functions on it, putting it in variables
	counties = topojson.feature(shapes, shapes.objects.counties).features;
	states = topojson.feature(shapes, shapes.objects.states).features;
	
	//
	var statePaths = svg.append("g")
	.selectAll("path")
	.data(states)
	.enter()
	.append("path").attr("d", path)
	.style("fill", function(crimes){
		return populationScale(5);
	}).style("stroke", "#ccc"); 

	d3.json("data.json", function (error, rows) {
		statePaths.selectAll("path").style("stroke","");
	});

});


</script>



<script>

d3.json("unemployment.json", function(error, data){
	unemploymentVisualize(data);
});//strings to JSON 

function unemploymentVisualize(data){
	console.log(d3.values(data.fl));
}

// {
// "unemployment":[
// {"Alabama":"6.1"},
// {"Alaska":"6.4"},
// {"Arizona":"7.6"},
// {"Arkansas":"7.4"},
function hereDoc(f) {
  return f.toString().
      replace(/^[^\/]+\/\*!?/, '').
      replace(/\*\/[^\/]+$/, '');
}
var stateUnemploy = hereDoc(function() {/*!Alabama
6.1
Alaska
6.4
Arizona
7.6
Arkansas
7.4
California
8.3
Colorado
6.2
Connecticut
7.4
Delaware
6.2
District of Columbia
8.1
Florida
6.2
Georgia
7.4
Hawaii
4.5
Idaho
5.7
Illinois
8.6
Indiana
6.9
Iowa
4.2
Kansas
4.9
Kentucky
8.0
Louisiana
5.7
Maine
6.2
Maryland
6.1
Massachusetts
7.0
Michigan
8.4
Minnesota
4.6
Mississippi
8.0
Missouri
5.9
Montana
5.2
Nebraska
3.6
Nevada
8.8
New Hampshire
5.1
New Jersey
7.3
New Mexico
6.4
New York
7.1
North Carolina
6.9
North Dakota
2.6
Ohio
7.2
Oklahoma
5.4
Oregon
7.0
Pennsylvania
6.9
Rhode Island
9.1
South Carolina
6.6
South Dakota
3.6
Tennessee
7.8
Texas
6.0
Utah
4.1
Vermont
4.2
Virginia
5.2
Washington
6.6
West Virginia
5.9
Wisconsin
6.2
Wyoming
4.4

*/});

stateUnemploy = stateUnemploy.replace( /\n/g, " " ).split( " " );

var outputStr ="";
for (var i =0; i<stateUnemploy.length;i=i+2){
	outputStr += "{\"" + stateUnemploy[i] + "\" : \"" + stateUnemploy[i+1] + "\"} , "

}
console.log(outputStr);


</script>


</body>

</html>