<html>
<head>
	<title></title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="stateID.js"></script>

	<title>The Crime Rate Map</title>
	<style>
	* {
		margin: 0;
		padding: 0;
	}
	body {
		font-family: "Verdana";
		background-color: #f2f2f2;
	}
	.counties {
		fill: none;
	}


	.states {
		fill: none;
		stroke: #fff;
		stroke-linejoin: round;
	}
	.maplinewrap {
		margin: auto;
		margin-top: 20px;
	}
	.mapContainer {
		 display: inline-block;
	}

	</style>
</head>
<body>
	 <!--Title and text -->	
	 <h1>2013 US Crime Rate Map</h1>
	 <p>The maps below show the number of different types of crime out of 100,000 people. The darker the color is, the more frequent the occurence of the crime. </p>
	 <p>Crime Index = Number of Violent Crime + Number of Property Crime. Violent Crime includes Murder, Forcible Rape, Robbery, and Aggravated Assault. Property Crime here includes Burglary, Larceny-Theft and Vehicle-Theft.</p>


	<div class = "maplinewrap">
		<div class="mapContainer">
			<h4>Crime Index</h4>
			<div id="map1"></div>              
		</div>
		<div class="mapContainer">
			<h4>Violent Crime</h4>
			<div id="map2"></div>
		</div>
		<div class="mapContainer">
			<h4>Property Crime</h4>
			<div id="map3"></div>
		</div>
		<div class="mapContainer">
			<h4>Murder</h4>
			<div id="map4"></div>
		</div>
		<div class="mapContainer">
			<h4>Forcible Rape</h4>
			<div id="map5"></div>
		</div>
	<div class = "maplinewrap">
		<div class="mapContainer">
			<h4>Robbery</h4>
			<div id="map6"></div>
		</div>
		<div class="mapContainer">
			<h4>Aggravated Assault</h4>
			<div id="map7"></div>
		</div>
		<div class="mapContainer">
			<h4>Burglary</h4>
			<div id="map8"></div>
		</div>
		<div class="mapContainer">
			<h4>Larceny-Theft</h4>
			<div id="map9"></div>
		</div>
		<div class="mapContainer">
			<h4>Vehicle-Theft</h4>
			<div id="map10"></div>
		</div>
	</div>
	

	<script>

	var width = 1200,
	height = 400;


	var projection = d3.geo.albersUsa()
	.scale(320)
	.translate([width / 2, height / 2]);

	var path = d3.geo.path()
	.projection(projection);





	d3.json("us.json", function(error, us) {
		if (error) return console.error(error);
		var states = topojson.feature(us, us.objects.states).features;

  //Map for Crime Index.
  var svg1 = d3.select("#map1").append("svg")
  .attr("width", width)
  .attr("height", height);

  d3.json("data.json", function(error, data){

  	var statePaths = svg1.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Index"]*100000.0)/data[i]["2013"]["Population"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);

      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      //gradient code

      var xScale = d3.scale.linear().domain([min, max]).range([0, width]);
      var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("d"));
      var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("d"));

      svg1.append("g").attr("transform", "translate(0," + (height - 20) + ")").attr("class", "axis")
      .call(xAxis);

      
      var dataArray = d3.entries(data);
      console.log(dataArray);


      var labels = 
      svg1.selectAll("g")
      .data(dataArray)
      .enter()
      .append("g")
      .attr("transform", function(d, i){
        return "translate(" + xScale( (d.value[2013]["Index"] * 100000 )/  d.value[2013]["Population"] ) + ", 300)";
      });

      // labels.append("line")
      // .attr("x1", function(d) {return xScale( (d.value[2013]["Index"] * 100000 )/  d.value[2013]["Population"]) })
      // .attr("x2", function(d) {return xScale( (d.value[2013]["Index"] * 100000 )/  d.value[2013]["Population"]) })
      // .attr("y1", "0")
      // .attr("y2", "20");


      labels.append("text")
      .text( function(d) {return abbrState(d.key, 'name') })
      .attr('text-anchor', 'left')
      .attr("transform", "rotate(70)")
      .attr("font-size", "0.5rem");


      //gradient code end

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Index"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#fff');

  });

  //Map for Violent Crime
  var svg2 = d3.select("#map2").append("svg")
  .attr("width", width)
  .attr("height", height);

  d3.json("data.json", function(error, data){


  	var statePaths = svg2.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Violent"]*100000.0)/data[i]["2013"]["Population"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);

      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Violent"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#ccc');

  });

  //Map for Property Crime
  var svg3 = d3.select("#map3").append("svg")
  .attr("width", width)
  .attr("height", height);

  d3.json("data.json", function(error, data){


  	var statePaths = svg3.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Property"]*100000.0)/data[i]["2013"]["Population"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);

      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Property"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#ccc');

  });

  //Map for Murder
  var svg4 = d3.select("#map4").append("svg")
  .attr("width", width)
  .attr("height", height);

  d3.json("data.json", function(error, data){


  	var statePaths = svg4.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Murder"]*100000.0)/data[i]["2013"]["Population"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);

      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Murder"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#ccc');

  });

 //Map for Robbery
 var svg6 = d3.select("#map6").append("svg")
 .attr("width", width)
 .attr("height", height);

 d3.json("data.json", function(error, data){


 	var statePaths = svg6.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Robbery"]*100000.0)/data[i]["2013"]["Population"]);
      	console.log(i,  data[i]["2013"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);
      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Robbery"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#ccc');

  });


//Map for Robbery
var svg8 = d3.select("#map8").append("svg")
.attr("width", width)
.attr("height", height);

d3.json("data.json", function(error, data){


	var statePaths = svg8.append('g');
      var valueArray = []; //An array to store values to fine the min max in order to set the color scale
      for (var i in data){
      	valueArray.push((data[i]["2013"]["Burglary"]*100000.0)/data[i]["2013"]["Population"]);
      	console.log(i,  data[i]["2013"]);         
      }
      var max = Math.max.apply(Math, valueArray);
      var min = Math.min.apply(Math, valueArray);
      var crimeScale = d3.scale.linear().domain([min, max]).range(["#ffe6e6", "#4d0000"]);

      statePaths.selectAll('path').data(states).enter()
      .append('path').attr('d', path).attr("id", function(state) {return state.id})
      .style('fill', function(state){

      	if (typeof data[stateid[state.id]] != 'undefined' && typeof data[stateid[state.id]]["2013"] != 'undefined'){
      		return crimeScale(data[stateid[state.id]]["2013"]["Burglary"]*100000.0/data[stateid[state.id]]["2013"]["Population"])}

      	})

      .style('stroke', '#ccc');

  });





});

function abbrState(input, to){
      
      var states = [
          ['Arizona', 'AZ'],
          ['Alabama', 'AL'],
          ['Alaska', 'AK'],
          ['Arizona', 'AZ'],
          ['Arkansas', 'AR'],
          ['California', 'CA'],
          ['Colorado', 'CO'],
          ['Connecticut', 'CT'],
          ['Delaware', 'DE'],
          ['Florida', 'FL'],
          ['Georgia', 'GA'],
          ['Hawaii', 'HI'],
          ['Idaho', 'ID'],
          ['Illinois', 'IL'],
          ['Indiana', 'IN'],
          ['Iowa', 'IA'],
          ['Kansas', 'KS'],
          ['Kentucky', 'KY'],
          ['Kentucky', 'KY'],
          ['Louisiana', 'LA'],
          ['Maine', 'ME'],
          ['Maryland', 'MD'],
          ['Massachusetts', 'MA'],
          ['Michigan', 'MI'],
          ['Minnesota', 'MN'],
          ['Mississippi', 'MS'],
          ['Missouri', 'MO'],
          ['Montana', 'MT'],
          ['Nebraska', 'NE'],
          ['Nevada', 'NV'],
          ['New Hampshire', 'NH'],
          ['New Jersey', 'NJ'],
          ['New Mexico', 'NM'],
          ['New York', 'NY'],
          ['North Carolina', 'NC'],
          ['North Dakota', 'ND'],
          ['Ohio', 'OH'],
          ['Oklahoma', 'OK'],
          ['Oregon', 'OR'],
          ['Pennsylvania', 'PA'],
          ['Rhode Island', 'RI'],
          ['South Carolina', 'SC'],
          ['South Dakota', 'SD'],
          ['Tennessee', 'TN'],
          ['Texas', 'TX'],
          ['Utah', 'UT'],
          ['Vermont', 'VT'],
          ['Virginia', 'VA'],
          ['Washington', 'WA'],
          ['West Virginia', 'WV'],
          ['Wisconsin', 'WI'],
          ['Wyoming', 'WY'],
      ];

      if (to == 'abbr'){
          input = input.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
          for(i = 0; i < states.length; i++){
              if(states[i][0] == input){
                  return(states[i][1]);
              }
          }    
      } else if (to == 'name'){
          input = input.toUpperCase();
          for(i = 0; i < states.length; i++){
              if(states[i][1] == input){
                  return(states[i][0]);
              }
          }    
      }
  }

</script>
</body>
</html>